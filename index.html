<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام المحافظ والعملات</title>
<style>
    body {
        background-color: #121212;
        color: #FFD700;
        font-family: Tahoma, sans-serif;
        text-align: center;
    }
    h1,h2,h3 { color: #FFD700; }
    input, button, select {
        padding: 10px;
        margin: 5px;
        border-radius: 5px;
        border: none;
        outline: none;
        font-weight: bold;
    }
    input { width: 200px; }
    button {
        background-color: #FFD700;
        color: #121212;
        cursor: pointer;
    }
    button:hover { background-color: #ffcc00; }
    .hidden { display: none; }
    .section { border: 1px solid #FFD700; padding: 20px; margin: 20px; border-radius: 10px; }
    table { width: 80%; margin: auto; border-collapse: collapse; }
    th, td { border: 1px solid #FFD700; padding: 8px; }
</style>
</head>
<body>

<h1>🔹 نظام المحافظ والعملات 🔹</h1>

<!-- تسجيل الدخول -->
<div id="login-section" class="section">
    <h2>تسجيل الدخول</h2>
    <input id="loginName" placeholder="اسم المستخدم"><br>
    <input id="loginBank" placeholder="كود البطاقة البنكية"><br>
    <input id="loginWallet" placeholder="كود المحفظة"><br>
    <input id="loginPass" type="password" placeholder="كلمة السر"><br>
    <button onclick="login()">دخول</button>
</div>

<!-- واجهة المستخدم -->
<div id="user-section" class="section hidden">
    <h2>مرحبا بك <span id="userName"></span></h2>
    <p>كود البطاقة البنكية: <span id="userBank"></span></p>
    <p>كود المحفظة: <span id="userWallet"></span></p>
    <h3>أرصدة العملات</h3>
    <div id="userBalances"></div>
    <h3>سجل العمليات</h3>
    <div id="userHistory"></div>
    <button onclick="logout()">تسجيل الخروج</button>
</div>

<!-- الإدارة العادية -->
<div id="admin-section" class="section hidden">
    <h2>الإدارة العادية</h2>
    <h3>إضافة محفظة</h3>
    <input id="newName" placeholder="اسم المستخدم"><br>
    <input id="newBank" placeholder="كود البطاقة البنكية"><br>
    <input id="newPass" type="password" placeholder="كلمة السر"><br>
    <button onclick="createWallet()">إنشاء المحفظة</button>
    <h3>شراء/بيع</h3>
    <input id="opUser" placeholder="اسم المستخدم"><br>
    <select id="opType">
        <option value="buy">شراء</option>
        <option value="sell">بيع</option>
    </select>
    <select id="opCoin">
        <option value="N">Nano</option>
        <option value="D">Dash</option>
        <option value="B">Bitcoin</option>
    </select>
    <input id="opAmount" type="number" placeholder="الكمية"><br>
    <button onclick="doOperation()">تنفيذ العملية</button>
    <div id="opResult"></div>
    <button onclick="logout()">تسجيل الخروج</button>
</div>

<!-- الإدارة العليا -->
<div id="superadmin-section" class="section hidden">
    <h2>الإدارة العليا</h2>
    <h3>بحث وتعديل الحسابات</h3>
    <input id="searchUser" placeholder="اسم المستخدم">
    <button onclick="searchAccount()">بحث</button>
    <div id="accountInfo"></div>

    <h3>تعديل أسعار العملات يدويا</h3>
    <div id="priceEditor"></div>

    <h3>تقرير شامل</h3>
    <div id="fullReport"></div>
    <button onclick="generateFullReport()">عرض التقرير</button>
    <button onclick="resetReport()">إعادة تعيين التقرير</button><br><br>

    <button onclick="logout()">تسجيل الخروج</button>
</div>

<script>
let users = []; 
let transactions = [];
let prices = { N: 1000, D: 5000, B: 20000 };
let report = { buys: 0, sells: 0, accounts: 0 };
let currentUser = null;
let priceInterval = 45*60*1000; // 45 دقيقة

function login() {
    const name = document.getElementById("loginName").value;
    const bank = document.getElementById("loginBank").value;
    const wallet = document.getElementById("loginWallet").value;
    const pass = document.getElementById("loginPass").value;

    // إدارة عليا
    if(pass === "TECNO XXX") {
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("superadmin-section").classList.remove("hidden");
        updatePriceEditor();
        return;
    }
    // إدارة عادية
    if(pass === "TECNO LD7") {
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("admin-section").classList.remove("hidden");
        return;
    }

    // مستخدم عادي
    let u = users.find(x=>x.name===name && x.bank===bank && x.wallet===wallet && x.pass===pass);
    if(u) {
        currentUser = u;
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("user-section").classList.remove("hidden");
        document.getElementById("userName").innerText = u.name;
        document.getElementById("userBank").innerText = u.bank;
        document.getElementById("userWallet").innerText = u.wallet;
        updateUserInfo();
    } else alert("بيانات تسجيل الدخول غير صحيحة");
}

function logout(){
    document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden"));
    document.getElementById("login-section").classList.remove("hidden");
}

function createWallet() {
    let name=document.getElementById("newName").value;
    let bank=document.getElementById("newBank").value;
    let pass=document.getElementById("newPass").value;
    if(users.find(u=>u.bank===bank)) return alert("هذه البطاقة مستخدمة بالفعل!");
    let wallet="Z"+String(users.length).padStart(3,"0")+"Z";
    users.push({name,bank,pass,wallet,balances:{N:0,D:0,B:0},history:[]});
    report.accounts++;
    alert("تم إنشاء المحفظة بكود: "+wallet);
}

function doOperation(){
    let name=document.getElementById("opUser").value;
    let u=users.find(x=>x.name===name);
    if(!u) return alert("المستخدم غير موجود");
    let type=document.getElementById("opType").value;
    let coin=document.getElementById("opCoin").value;
    let amt=parseInt(document.getElementById("opAmount").value);
    if(amt<=0) return;
    let price = prices[coin]*amt;
    if(type==="buy"){
        u.balances[coin]+=amt;
        report.buys++;
        transactions.push(`${u.name} اشترى ${amt}${coin} بسعر ${price}`);
    } else {
        if(u.balances[coin]<amt) return alert("رصيد غير كافي");
        u.balances[coin]-=amt;
        report.sells++;
        transactions.push(`${u.name} باع ${amt}${coin} بسعر ${price}`);
    }
    u.history.push(transactions[transactions.length-1]);
    document.getElementById("opResult").innerText=transactions[transactions.length-1];

    // تغيير السعر بعد العملية
    changePricesAfterOperation();
    updateUserInfo();
}

function updateUserInfo(){
    if(!currentUser) return;
    let bal=currentUser.balances;
    document.getElementById("userBalances").innerHTML=
        `Nano: ${bal.N}<br>Dash: ${bal.D}<br>Bitcoin: ${bal.B}`;
    document.getElementById("userHistory").innerHTML=currentUser.history.slice(-5).join("<br>");
}

function changePricesAfterOperation(){
    for(let c in prices){
        let r=Math.random();
        if(r>0.5) prices[c]*=1.2;
        else prices[c]*=0.85;
        prices[c]=Math.round(prices[c]);
    }
    updatePriceEditor();
}

function updatePriceEditor(){
    document.getElementById("priceEditor").innerHTML=
        Object.entries(prices).map(([k,v])=>
        `${k}: <input value="${v}" onchange="prices['${k}']=parseInt(this.value)">`).join("<br>");
}

function searchAccount(){
    let name=document.getElementById("searchUser").value;
    let u=users.find(x=>x.name===name);
    if(!u) return alert("لم يتم العثور على الحساب");
    document.getElementById("accountInfo").innerHTML=
        `الاسم: ${u.name}<br>البنك: ${u.bank}<br>المحفظة: ${u.wallet}<br>
         Nano:${u.balances.N} Dash:${u.balances.D} Bitcoin:${u.balances.B}<br>
         <button onclick="deleteAccount('${u.name}')">حذف الحساب</button>`;
}

function deleteAccount(name){
    users=users.filter(x=>x.name!==name);
    alert("تم حذف الحساب");
    document.getElementById("accountInfo").innerHTML="";
}

function generateFullReport(){
    document.getElementById("fullReport").innerHTML=
        `عدد الحسابات: ${report.accounts}<br>
         عدد الشراء: ${report.buys}<br>
         عدد البيع: ${report.sells}<br>
         العمليات:<br>${transactions.join("<br>")}`;
}

function resetReport(){
    report={buys:0,sells:0,accounts:users.length};
    transactions=[];
    alert("تمت إعادة تعيين التقرير");
}

// تغيير الأسعار كل 45 دقيقة
setInterval(changePricesAfterOperation,priceInterval);

</script>
</body>
</html>