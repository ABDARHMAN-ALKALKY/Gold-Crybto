<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoldCrypto</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Tajawal', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #1a1a1a, #3a2c0f, #d4af37); }
  </style>
</head>
<body class="bg-gray-900 text-white p-5">

  <h1 class="text-4xl font-bold text-center mb-8 text-yellow-400">✨ قسم GoldCrypto ✨</h1>

  <!-- جدول العملات -->
  <div class="overflow-x-auto mb-5">
    <table class="w-full bg-gray-800 shadow-lg rounded-lg overflow-hidden">
      <thead class="bg-yellow-500 text-black">
        <tr>
          <th class="p-3">العملة</th>
          <th class="p-3">السعر (غولد)</th>
          <th class="p-3">الحد اليومي</th>
        </tr>
      </thead>
      <tbody id="cryptoTable" class="text-center"></tbody>
    </table>
  </div>

  <!-- نموذج الطلب -->
  <div class="bg-gray-800 shadow-lg rounded-lg p-5 mb-5">
    <h2 class="text-2xl font-bold mb-3 text-yellow-300">تنفيذ عملية</h2>
    <form id="tradeForm" class="grid grid-cols-1 md:grid-cols-5 gap-3">
      <select id="coin" class="p-2 border rounded bg-gray-700 text-white">
        <option value="BTC">Bitcoin (BTC)</option>
        <option value="DASH">DASH</option>
        <option value="USDT">Tether (USDT)</option>
        <option value="XMR">Monero (XMR)</option>
        <option value="NANO">Nano (NANO)</option>
        <option value="LTC">Litecoin (LTC)</option>
      </select>

      <select id="type" class="p-2 border rounded bg-gray-700 text-white">
        <option value="buy">شراء</option>
        <option value="sell">بيع</option>
      </select>

      <input type="number" id="amount" placeholder="الكمية" min="1" class="p-2 border rounded bg-gray-700 text-white">

      <input type="text" id="code" placeholder="كود المستخدم" class="p-2 border rounded bg-gray-700 text-white">

      <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
        تنفيذ العملية
      </button>
    </form>
  </div>

  <!-- سجل العمليات -->
  <div class="bg-gray-800 shadow-lg rounded-lg p-5 mb-5">
    <h2 class="text-2xl font-bold mb-3 text-yellow-300">سجل العمليات</h2>
    <ul id="log" class="space-y-2 text-gray-300"></ul>
  </div>

  <!-- زر التقرير -->
  <div class="text-center mb-10">
    <button onclick="openReport()" class="bg-blue-500 text-white px-6 py-3 rounded text-xl hover:bg-blue-600 transition">
      📝 طلب التقرير اليومي
    </button>
  </div>

  <script>
    let coins = {
      BTC: { name: "Bitcoin (BTC)", price: 1000, dailyLimit: 1, k: 0.02 },
      DASH: { name: "DASH", price: 250, dailyLimit: 3, k: 0.015 },
      USDT: { name: "Tether (USDT)", price: 100, dailyLimit: 5, k: 0.01 },
      XMR: { name: "Monero (XMR)", price: 600, dailyLimit: 1, k: 0.02 },
      NANO: { name: "Nano (NANO)", price: 120, dailyLimit: 10, k: 0.005 },
      LTC: { name: "Litecoin (LTC)", price: 300, dailyLimit: 2, k: 0.015 },
    };

    let log = [];
    let userDailyOps = {};

    function updateTable() {
      let table = document.getElementById("cryptoTable");
      table.innerHTML = "";
      for (let key in coins) {
        table.innerHTML += `
          <tr class="border-b border-gray-700 hover:bg-gray-700 transition">
            <td class="p-2">${coins[key].name}</td>
            <td class="p-2">${coins[key].price.toFixed(2)}</td>
            <td class="p-2">${coins[key].dailyLimit} / يوم</td>
          </tr>
        `;
      }
    }

    function updateLog() {
      let logList = document.getElementById("log");
      logList.innerHTML = log.map(entry => `
        <li class="border-b border-gray-700 p-2 flex justify-between items-center">
          ${entry.text}
          <button onclick="copyToClipboard('${entry.text}')" class="bg-yellow-500 text-black px-2 py-1 rounded hover:bg-yellow-600">نسخ</button>
        </li>
      `).join("");
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
      alert("تم نسخ النص ✅");
    }

    document.getElementById("tradeForm").addEventListener("submit", function(e) {
      e.preventDefault();
      let coinKey = document.getElementById("coin").value;
      let type = document.getElementById("type").value;
      let amount = parseFloat(document.getElementById("amount").value);
      let code = document.getElementById("code").value.trim();

      if (!code) return alert("أدخل كود المستخدم!");
      if (amount <= 0 || isNaN(amount)) return alert("أدخل كمية صحيحة!");

      if (!userDailyOps[code]) userDailyOps[code] = {};
      if (!userDailyOps[code][coinKey]) userDailyOps[code][coinKey] = 0;

      if (userDailyOps[code][coinKey] + amount > coins[coinKey].dailyLimit) {
        return alert("❌ تجاوزت الحد اليومي لهذه العملة!");
      }

      let oldPrice = coins[coinKey].price;
      let effect = type === "buy" ? amount : -amount;
      coins[coinKey].price = oldPrice * (1 + coins[coinKey].k * effect);

      userDailyOps[code][coinKey] += amount;

      let actionText = type === "buy" ? "شراء" : "بيع";
      let logEntry = {
        text: `${actionText} ${amount} ${coins[coinKey].name} بسعر ${oldPrice.toFixed(2)} غولد (كود: ${code})`,
        type,
        amount,
        coin: coinKey,
        value: amount * oldPrice
      };
      log.unshift(logEntry);

      updateTable();
      updateLog();
      document.getElementById("tradeForm").reset();
    });

    function openReport() {
      let totalBuy = 0, totalSell = 0;
      log.forEach(l => {
        if (l.type === "buy") totalBuy += l.value;
        else totalSell += l.value;
      });

      let today = new Date().toLocaleDateString('ar-EG');
      let buyLogs = log.filter(l=>l.type==='buy').map(l=>`<li>🟢 ${l.text}</li>`).join("") || "<li>لا توجد عمليات شراء</li>";
      let sellLogs = log.filter(l=>l.type==='sell').map(l=>`<li>🔴 ${l.text}</li>`).join("") || "<li>لا توجد عمليات بيع</li>";

      let reportHTML = `
        <html lang="ar" dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>تقرير GoldCrypto</title>
          <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        </head>
        <body class="gradient-bg text-white min-h-screen flex justify-center items-center p-5">
          <div class="bg-black bg-opacity-70 border-4 border-yellow-500 rounded-2xl shadow-2xl p-8 w-full max-w-3xl">
            <h1 class="text-3xl text-yellow-400 font-bold text-center mb-6">📜 تقرير GoldCrypto اليومي</h1>
            <p class="text-center text-gray-300 mb-4">🗓️ تاريخ اليوم: ${today}</p>

            <h2 class="text-2xl text-green-400 mb-3">💠 عمليات الشراء</h2>
            <ul class="mb-5 space-y-1 text-gray-200">${buyLogs}</ul>
            <p class="text-green-400 font-bold mb-6">الإجمالي: ${totalBuy.toFixed(2)} G</p>

            <h2 class="text-2xl text-red-400 mb-3">💠 عمليات البيع</h2>
            <ul class="mb-5 space-y-1 text-gray-200">${sellLogs}</ul>
            <p class="text-red-400 font-bold mb-6">الإجمالي: ${totalSell.toFixed(2)} G</p>

            <div class="border-t border-yellow-600 mt-5 pt-5">
              <p class="text-yellow-300">• حالة الفرع: هادئ 🖇️</p>
              <p class="text-yellow-300">• المشاكل: لا توجد حاليا</p>
              <p class="text-yellow-300 font-bold mt-3">📌 تم إعداد هذا التقرير بواسطة المساعد الآلي لنظام GoldCrypto 🤖</p>
              <p class="text-gray-400 mt-3 text-sm">تم توليد التقرير تلقائياً من النظام ✅</p>
            </div>

            <div class="mt-6 flex justify-between">
              <button onclick="navigator.clipboard.writeText(document.body.innerText)" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-600">📋 نسخ التقرير</button>
              <button onclick="downloadReport()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">💾 تنزيل التقرير</button>
            </div>
          </div>

          <script>
            function downloadReport() {
              const blob = new Blob([document.body.innerText], {type: 'text/plain'});
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'تقرير-GoldCrypto-${today}.txt';
              a.click();
              URL.revokeObjectURL(url);
            }
          <\/script>
        </body>
        </html>
      `;

      let win = window.open("", "_blank");
      win.document.write(reportHTML);
      win.document.title = "تقرير GoldCrypto اليومي";
    }

    updateTable();
  </script>

</body>
  </html>
