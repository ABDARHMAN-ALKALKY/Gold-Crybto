<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>نظام المحافظ</title>
<style>
body {font-family: Arial; direction: rtl; background: #f5f5f5; padding: 20px;}
.container {max-width: 950px; margin: auto; background: white; padding: 20px; border-radius: 10px;}
h2 {text-align: center;}
.hidden {display: none;}
input, button, select {margin: 5px; padding: 8px;}
table {width: 100%; border-collapse: collapse; margin-top: 10px;}
td, th {border: 1px solid #ccc; padding: 5px; text-align: center;}
textarea {width: 100%; height: 120px;}
.admin-btn {margin: 5px;}
</style>
</head>
<body>
<div class="container">
  <h2>💰 نظام المحافظ للعملات</h2>

  <!-- تسجيل الدخول -->
  <div id="loginDiv">
    <h3>تسجيل دخول العميل</h3>
    <input id="loginName" placeholder="اسم الحساب"><br>
    <input id="loginCard" placeholder="كود البطاقة البنكية"><br>
    <input id="loginPass" type="password" placeholder="كلمة السر"><br>
    <button onclick="login()">دخول</button>
    <hr>
    <h3>تسجيل دخول الإدارة</h3>
    <input id="adminPass" type="password" placeholder="كلمة سر الإدارة"><br>
    <button onclick="adminLogin()">دخول الإدارة</button>
    <hr>
    <h3>تسجيل دخول الإدارة العليا</h3>
    <input id="superPass" type="password" placeholder="كود الإدارة العليا"><br>
    <button onclick="superLogin()">دخول الإدارة العليا</button>
  </div>

  <!-- واجهة العميل -->
  <div id="userDiv" class="hidden">
    <h3>📊 حسابك</h3>
    <div>رصيدك:</div>
    <table id="balanceTable">
      <tr><th>العملة</th><th>الكمية</th></tr>
    </table>
    <div>أسعار العملات:</div>
    <table id="priceTable">
      <tr><th>العملة</th><th>السعر (G)</th></tr>
    </table>
    <h4>سجل العمليات</h4>
    <textarea id="userLog" readonly></textarea><br>
    <button onclick="getUserReport()">طلب تقرير</button>
    <button onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- واجهة الإدارة -->
  <div id="adminDiv" class="hidden">
    <h3>⚙️ لوحة الإدارة</h3>
    <button onclick="showDiv('buySellDiv')">شراء / بيع</button>
    <button onclick="showDiv('priceDiv')">تعديل الأسعار يدوياً</button>
    <button onclick="showDiv('reportDiv')">عرض التقرير اليومي</button>
    <button onclick="logout()">تسجيل خروج</button>

    <div id="buySellDiv" class="hidden">
      <h4>شراء / بيع</h4>
      <input id="accCode" placeholder="كود المحفظة"><br>
      <select id="coinSelect">
        <option value="NANO">NANO</option>
        <option value="DASH">DASH</option>
        <option value="BTC">BTC</option>
      </select><br>
      <input id="amount" type="number" placeholder="الكمية"><br>
      <select id="typeSelect">
        <option value="buy">شراء</option>
        <option value="sell">بيع</option>
      </select><br>
      <button onclick="executeOperation()">تنفيذ العملية</button>
      <textarea id="operationLog" readonly></textarea>
    </div>

    <div id="priceDiv" class="hidden">
      <h4>تعديل الأسعار يدوياً</h4>
      <div id="manualPrices"></div>
      <button onclick="savePrices()">حفظ الأسعار الجديدة</button>
    </div>

    <div id="reportDiv" class="hidden">
      <h4>التقرير اليومي</h4>
      <textarea id="dailyReport" readonly></textarea>
    </div>
  </div>

  <!-- واجهة الإدارة العليا -->
  <div id="superDiv" class="hidden">
    <h3>🛡️ الإدارة العليا</h3>
    <input id="searchAcc" placeholder="بحث بالاسم أو الكود">
    <button onclick="searchAccount()">بحث</button>
    <div id="editAccountDiv"></div>
    <button onclick="generateSuperReport()">تقرير شامل</button>
    <button onclick="resetSystem()">إعادة تعيين النظام</button>
    <textarea id="superReport" readonly></textarea><br>
    <button onclick="logout()">تسجيل خروج</button>
  </div>
</div>

<script>
// بيانات افتراضية
let users = [
  {name:"Ahmed", card:"A000A", pass:"1234", code:"Z000Z", balance:{NANO:2,DASH:1,BTC:0}, log:[]},
];
let prices = {NANO:1000, DASH:2000, BTC:3000};
let dailyLog = [];
let currentUser = null;

// تحديث الجداول
function updateTables(){
  if(currentUser){
    let balTable = document.getElementById("balanceTable");
    balTable.innerHTML = "<tr><th>العملة</th><th>الكمية</th></tr>";
    for(let c in currentUser.balance){
      balTable.innerHTML += `<tr><td>${c}</td><td>${currentUser.balance[c]}</td></tr>`;
    }
    let priceTable = document.getElementById("priceTable");
    priceTable.innerHTML = "<tr><th>العملة</th><th>السعر (G)</th></tr>";
    for(let c in prices){
      priceTable.innerHTML += `<tr><td>${c}</td><td>${prices[c]}</td></tr>`;
    }
    document.getElementById("userLog").value = currentUser.log.join("\n");
  }
}

// تسجيل الدخول
function login(){
  let name=document.getElementById("loginName").value;
  let card=document.getElementById("loginCard").value;
  let pass=document.getElementById("loginPass").value;
  let user=users.find(u=>u.name===name && u.card===card && u.pass===pass);
  if(user){
    currentUser=user;
    showOnly("userDiv");
    updateTables();
  } else alert("بيانات خاطئة");
}

function logout(){
  currentUser=null;
  showOnly("loginDiv");
}

function adminLogin(){
  if(document.getElementById("adminPass").value==="ADMIN"){
    showOnly("adminDiv");
    renderManualPrices();
  } else alert("كلمة مرور خاطئة");
}

function superLogin(){
  if(document.getElementById("superPass").value==="TECNO LKL"){
    showOnly("superDiv");
  } else alert("رمز خاطئ");
}

// إظهار واجهة محددة
function showOnly(id){
  document.querySelectorAll(".container > div").forEach(div=>div.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// إظهار جزء في الإدارة
function showDiv(id){
  document.querySelectorAll("#adminDiv > div").forEach(div=>div.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// تنفيذ الشراء والبيع
function executeOperation(){
  let code=document.getElementById("accCode").value;
  let coin=document.getElementById("coinSelect").value;
  let amount=parseInt(document.getElementById("amount").value);
  let type=document.getElementById("typeSelect").value;
  let user=users.find(u=>u.code===code);
  if(!user || !amount) return alert("خطأ في البيانات");
  let price=prices[coin]*amount;
  if(type==="buy"){
    user.balance[coin]+=amount;
    prices[coin]=Math.round(prices[coin]*1.2); // يزيد 20%
    user.log.push(`شراء ${amount} ${coin} بسعر ${price}G`);
    dailyLog.push(`شراء:${code}-${coin}-${amount}`);
  }else{
    if(user.balance[coin]<amount) return alert("رصيد غير كافٍ");
    user.balance[coin]-=amount;
    prices[coin]=Math.round(prices[coin]*0.85); // ينقص 15%
    user.log.push(`بيع ${amount} ${coin} بسعر ${price}G`);
    dailyLog.push(`بيع:${code}-${coin}-${amount}`);
  }
  document.getElementById("operationLog").value=`خصم من البطاقة ${user.card}\n${price}G\n${type==="buy"?"اشترى":"باع"} ${amount}${coin[0]}\nكود المحفظة ${user.code}`;
  updateTables();
}

// تعديل الأسعار اليدوي
function renderManualPrices(){
  let div=document.getElementById("manualPrices");
  div.innerHTML="";
  for(let c in prices){
    div.innerHTML+=`${c}: <input id="price_${c}" value="${prices[c]}"><br>`;
  }
}

function savePrices(){
  for(let c in prices){
    let val=parseInt(document.getElementById(`price_${c}`).value);
    if(!isNaN(val)) prices[c]=val;
  }
  alert("تم تحديث الأسعار");
  updateTables();
}

// تقرير يومي
function getUserReport(){
  alert(currentUser.log.join("\n") || "لا يوجد عمليات");
}

function showDailyReport(){
  document.getElementById("dailyReport").value=dailyLog.join("\n")||"لا يوجد عمليات اليوم";
}

// الإدارة العليا
function searchAccount(){
  let val=document.getElementById("searchAcc").value;
  let user=users.find(u=>u.name===val||u.code===val);
  let div=document.getElementById("editAccountDiv");
  if(user){
    div.innerHTML=`<b>${user.name} (${user.code})</b><br>
    NANO:<input id="editN" value="${user.balance.NANO}">
    DASH:<input id="editD" value="${user.balance.DASH}">
    BTC:<input id="editB" value="${user.balance.BTC}">
    <button onclick="saveAccount('${user.code}')">حفظ</button>`;
  }else div.innerHTML="لم يتم العثور على الحساب";
}

function saveAccount(code){
  let user=users.find(u=>u.code===code);
  user.balance.NANO=parseInt(document.getElementById("editN").value);
  user.balance.DASH=parseInt(document.getElementById("editD").value);
  user.balance.BTC=parseInt(document.getElementById("editB").value);
  alert("تم الحفظ");
  updateTables();
}

function generateSuperReport(){
  let txt=`عدد الحسابات: ${users.length}\nإجمالي العمليات: ${dailyLog.length}\n`;
  txt+=dailyLog.join("\n");
  document.getElementById("superReport").value=txt;
}

function resetSystem(){
  dailyLog=[];
  alert("تمت إعادة تعيين التقرير اليومي");
}

// تغيير تلقائي للأسعار كل ساعة (هنا للتجربة كل دقيقة)
setInterval(()=>{
  for(let c in prices){
    let up=Math.random()>0.5;
    prices[c]=Math.round(prices[c]*(up?1.2:0.85));
  }
  updateTables();
},60000);
</script>
</body>
</html>