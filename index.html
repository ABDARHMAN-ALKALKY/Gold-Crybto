<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>قسم GoldCrypto</title>
    <style>
        body {
            background: linear-gradient(to bottom, #1e1e2f, #292945);
            color: #f5f5f5;
            font-family: "Cairo", sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 {
            color: #ffcc00;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            background: #2f2f47;
            border-radius: 12px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #444;
        }
        th {
            background-color: #ffcc00;
            color: #000;
        }
        .btn {
            padding: 10px 20px;
            margin: 10px;
            background: #ffcc00;
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn:hover {
            background: #ffd633;
        }
        .operations {
            margin: 20px auto;
            width: 80%;
            background: #2f2f47;
            padding: 20px;
            border-radius: 12px;
        }
        #log {
            margin-top: 20px;
            text-align: right;
        }
        .report-page {
            display: none;
            background: #1e1e2f;
            padding: 20px;
            border-radius: 12px;
            text-align: right;
            width: 80%;
            margin: auto;
        }
        .copy-btn {
            background: #00c896;
            color: #fff;
            margin: 5px;
        }
        .copy-btn:hover {
            background: #00e0a6;
        }
    </style>
</head>
<body>
    <h1>💰 قسم GoldCrypto</h1>

    <table>
        <tr>
            <th>العملة</th>
            <th>السعر الحالي (G)</th>
            <th>الحد اليومي</th>
            <th>شراء</th>
            <th>بيع</th>
        </tr>
        <tbody id="cryptoTable"></tbody>
    </table>

    <div class="operations">
        <h2>📜 سجل العمليات</h2>
        <div id="log">لا توجد عمليات بعد.</div>
        <button class="btn" onclick="copyLastOperation()">📄 نسخ آخر عملية</button>
        <button class="btn" onclick="showReport()">📝 طلب التقرير اليومي</button>
    </div>

    <div class="report-page" id="reportPage">
        <h2>📊 تقرير قسم GoldCrypto</h2>
        <div id="reportContent"></div>
        <button class="btn copy-btn" onclick="copyReport()">📋 نسخ التقرير</button>
        <button class="btn" onclick="hideReport()">🔙 رجوع</button>
    </div>

    <script>
        const cryptos = [
            {name: "Bitcoin (BTC)", price: 1000, base: 1000, dailyLimit: 1, bought: 0, sold: 0},
            {name: "DASH", price: 250, base: 250, dailyLimit: 3, bought: 0, sold: 0},
            {name: "Tether (USDT)", price: 100, base: 100, dailyLimit: 5, bought: 0, sold: 0},
            {name: "Monero (XMR)", price: 600, base: 600, dailyLimit: 1, bought: 0, sold: 0},
            {name: "Nano (NANO)", price: 120, base: 120, dailyLimit: 10, bought: 0, sold: 0},
            {name: "Litecoin (LTC)", price: 300, base: 300, dailyLimit: 2, bought: 0, sold: 0},
        ];

        const buyImpact = 0.02;   // زيادة 2% لكل عملية شراء
        const sellImpact = 0.015; // نقصان 1.5% لكل عملية بيع

        const table = document.getElementById("cryptoTable");
        const logDiv = document.getElementById("log");
        let operations = [];

        function renderTable() {
            table.innerHTML = "";
            cryptos.forEach((crypto, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${crypto.name}</td>
                    <td>${crypto.price.toFixed(2)}</td>
                    <td>${crypto.dailyLimit}</td>
                    <td><button class="btn" onclick="buy(${index})">شراء</button></td>
                    <td><button class="btn" onclick="sell(${index})">بيع</button></td>
                `;
                table.appendChild(row);
            });
        }

        function buy(index) {
            const c = cryptos[index];
            if (c.bought >= c.dailyLimit) {
                alert("❌ تجاوزت الحد اليومي لهذه العملة!");
                return;
            }
            c.bought++;
            c.price *= (1 + buyImpact);
            const op = `✅ شراء ${c.name} بسعر ${c.price.toFixed(2)}G`;
            operations.push(op);
            logDiv.innerHTML = operations.join("<br>");
            renderTable();
        }

        function sell(index) {
            const c = cryptos[index];
            c.sold++;
            c.price *= (1 - sellImpact);
            const op = `💱 بيع ${c.name} بسعر ${c.price.toFixed(2)}G`;
            operations.push(op);
            logDiv.innerHTML = operations.join("<br>");
            renderTable();
        }

        function copyLastOperation() {
            if (operations.length === 0) return alert("لا توجد عمليات لنسخها!");
            navigator.clipboard.writeText(operations[operations.length - 1]);
            alert("تم نسخ آخر عملية ✅");
        }

        function showReport() {
            document.querySelector(".operations").style.display = "none";
            document.querySelector("table").style.display = "none";
            document.querySelector("h1").style.display = "none";
            document.getElementById("reportPage").style.display = "block";

            let totalBuy = cryptos.reduce((a, c) => a + c.bought * c.price, 0).toFixed(2);
            let totalSell = cryptos.reduce((a, c) => a + c.sold * c.price, 0).toFixed(2);
            const today = new Date().toISOString().slice(0,10);

            let report = `
🤎✨ قسـم GoldCrypto ✨🤎

🗓️ تاريخ اليوم: ${today}

💠 إجمالي عمليات الشراء: ${totalBuy} G
💠 إجمالي عمليات البيع: ${totalSell} G

📌 عدد العمليات: ${operations.length}
${operations.length ? operations.map(o=>"• "+o).join("\n") : "- لا توجد عمليات"}

📄 الحالة العامة: مستقرة 🏷️

🖋️ كاتب التقرير: المساعد الآلي 🤖
            `;

            document.getElementById("reportContent").innerText = report;
        }

        function hideReport() {
            document.querySelector(".operations").style.display = "block";
            document.querySelector("table").style.display = "table";
            document.querySelector("h1").style.display = "block";
            document.getElementById("reportPage").style.display = "none";
        }

        function copyReport() {
            const reportText = document.getElementById("reportContent").innerText;
            navigator.clipboard.writeText(reportText);
            alert("تم نسخ التقرير ✅");
        }

        renderTable();
    </script>
</body>
</html>        <option value="DASH">DASH</option>
        <option value="USDT">Tether (USDT)</option>
        <option value="XMR">Monero (XMR)</option>
        <option value="NANO">Nano (NANO)</option>
        <option value="LTC">Litecoin (LTC)</option>
      </select>

      <select id="type" class="p-2 border rounded bg-gray-700 text-white">
        <option value="buy">شراء</option>
        <option value="sell">بيع</option>
      </select>

      <input type="number" id="amount" placeholder="الكمية" min="1" class="p-2 border rounded bg-gray-700 text-white">

      <input type="text" id="code" placeholder="كود المستخدم" class="p-2 border rounded bg-gray-700 text-white">

      <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
        تنفيذ العملية
      </button>
    </form>
  </div>

  <!-- سجل العمليات -->
  <div class="bg-gray-800 shadow-lg rounded-lg p-5 mb-5">
    <h2 class="text-2xl font-bold mb-3 text-yellow-300">سجل العمليات</h2>
    <ul id="log" class="space-y-2 text-gray-300"></ul>
  </div>

  <!-- زر التقرير -->
  <div class="text-center mb-10">
    <button onclick="openReport()" class="bg-blue-500 text-white px-6 py-3 rounded text-xl hover:bg-blue-600 transition">
      📝 طلب التقرير اليومي
    </button>
  </div>

  <script>
    let coins = {
      BTC: { name: "Bitcoin (BTC)", price: 1000, dailyLimit: 1, k: 0.02 },
      DASH: { name: "DASH", price: 250, dailyLimit: 3, k: 0.015 },
      USDT: { name: "Tether (USDT)", price: 100, dailyLimit: 5, k: 0.01 },
      XMR: { name: "Monero (XMR)", price: 600, dailyLimit: 1, k: 0.02 },
      NANO: { name: "Nano (NANO)", price: 120, dailyLimit: 10, k: 0.005 },
      LTC: { name: "Litecoin (LTC)", price: 300, dailyLimit: 2, k: 0.015 },
    };

    let log = [];
    let userDailyOps = {};

    function updateTable() {
      let table = document.getElementById("cryptoTable");
      table.innerHTML = "";
      for (let key in coins) {
        table.innerHTML += `
          <tr class="border-b border-gray-700 hover:bg-gray-700 transition">
            <td class="p-2">${coins[key].name}</td>
            <td class="p-2">${coins[key].price.toFixed(2)}</td>
            <td class="p-2">${coins[key].dailyLimit} / يوم</td>
          </tr>
        `;
      }
    }

    function updateLog() {
      let logList = document.getElementById("log");
      logList.innerHTML = log.map(entry => `
        <li class="border-b border-gray-700 p-2 flex justify-between items-center">
          ${entry.text}
          <button onclick="copyToClipboard('${entry.text}')" class="bg-yellow-500 text-black px-2 py-1 rounded hover:bg-yellow-600">نسخ</button>
        </li>
      `).join("");
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
      alert("تم نسخ النص ✅");
    }

    document.getElementById("tradeForm").addEventListener("submit", function(e) {
      e.preventDefault();
      let coinKey = document.getElementById("coin").value;
      let type = document.getElementById("type").value;
      let amount = parseFloat(document.getElementById("amount").value);
      let code = document.getElementById("code").value.trim();

      if (!code) return alert("أدخل كود المستخدم!");
      if (amount <= 0 || isNaN(amount)) return alert("أدخل كمية صحيحة!");

      if (!userDailyOps[code]) userDailyOps[code] = {};
      if (!userDailyOps[code][coinKey]) userDailyOps[code][coinKey] = 0;

      if (userDailyOps[code][coinKey] + amount > coins[coinKey].dailyLimit) {
        return alert("❌ تجاوزت الحد اليومي لهذه العملة!");
      }

      let oldPrice = coins[coinKey].price;
      let effect = type === "buy" ? amount : -amount;
      coins[coinKey].price = oldPrice * (1 + coins[coinKey].k * effect);

      userDailyOps[code][coinKey] += amount;

      let actionText = type === "buy" ? "شراء" : "بيع";
      let logEntry = {
        text: `${actionText} ${amount} ${coins[coinKey].name} بسعر ${oldPrice.toFixed(2)} غولد (كود: ${code})`,
        type,
        amount,
        coin: coinKey,
        value: amount * oldPrice
      };
      log.unshift(logEntry);

      updateTable();
      updateLog();
      document.getElementById("tradeForm").reset();
    });

    function openReport() {
      let totalBuy = 0, totalSell = 0;
      log.forEach(l => {
        if (l.type === "buy") totalBuy += l.value;
        else totalSell += l.value;
      });

      let today = new Date().toLocaleDateString('ar-EG');
      let buyLogs = log.filter(l=>l.type==='buy').map(l=>`<li>🟢 ${l.text}</li>`).join("") || "<li>لا توجد عمليات شراء</li>";
      let sellLogs = log.filter(l=>l.type==='sell').map(l=>`<li>🔴 ${l.text}</li>`).join("") || "<li>لا توجد عمليات بيع</li>";

      let reportHTML = `
        <html lang="ar" dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>تقرير GoldCrypto</title>
          <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        </head>
        <body class="gradient-bg text-white min-h-screen flex justify-center items-center p-5">
          <div class="bg-black bg-opacity-70 border-4 border-yellow-500 rounded-2xl shadow-2xl p-8 w-full max-w-3xl">
            <h1 class="text-3xl text-yellow-400 font-bold text-center mb-6">📜 تقرير GoldCrypto اليومي</h1>
            <p class="text-center text-gray-300 mb-4">🗓️ تاريخ اليوم: ${today}</p>

            <h2 class="text-2xl text-green-400 mb-3">💠 عمليات الشراء</h2>
            <ul class="mb-5 space-y-1 text-gray-200">${buyLogs}</ul>
            <p class="text-green-400 font-bold mb-6">الإجمالي: ${totalBuy.toFixed(2)} G</p>

            <h2 class="text-2xl text-red-400 mb-3">💠 عمليات البيع</h2>
            <ul class="mb-5 space-y-1 text-gray-200">${sellLogs}</ul>
            <p class="text-red-400 font-bold mb-6">الإجمالي: ${totalSell.toFixed(2)} G</p>

            <div class="border-t border-yellow-600 mt-5 pt-5">
              <p class="text-yellow-300">• حالة الفرع: هادئ 🖇️</p>
              <p class="text-yellow-300">• المشاكل: لا توجد حاليا</p>
              <p class="text-yellow-300 font-bold mt-3">📌 تم إعداد هذا التقرير بواسطة المساعد الآلي لنظام GoldCrypto 🤖</p>
              <p class="text-gray-400 mt-3 text-sm">تم توليد التقرير تلقائياً من النظام ✅</p>
            </div>

            <div class="mt-6 flex justify-between">
              <button onclick="navigator.clipboard.writeText(document.body.innerText)" class="bg-yellow-500 text-black px-4 py-2 rounded hover:bg-yellow-600">📋 نسخ التقرير</button>
              <button onclick="downloadReport()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">💾 تنزيل التقرير</button>
            </div>
          </div>

          <script>
            function downloadReport() {
              const blob = new Blob([document.body.innerText], {type: 'text/plain'});
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'تقرير-GoldCrypto-${today}.txt';
              a.click();
              URL.revokeObjectURL(url);
            }
          <\/script>
        </body>
        </html>
      `;

      let win = window.open("", "_blank");
      win.document.write(reportHTML);
      win.document.title = "تقرير GoldCrypto اليومي";
    }

    updateTable();
  </script>

</body>
  </html>
